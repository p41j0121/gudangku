<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login Admin</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 400px;
      margin: auto;
    }
    input {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
    }
    button {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
    }
    #register-form, #login-form {
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h2 id="form-title">Login Admin</h2>

  <!-- Login Form -->
  <form id="login-form">
    <input type="text" id="login-username" placeholder="Username" required>
    <input type="password" id="login-password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>

  <!-- Register Form -->
  <form id="register-form" style="display: none;">
    <input type="text" id="register-username" placeholder="Username Baru" required>
    <input type="password" id="register-password" placeholder="Password Baru" required>
    <button type="submit">Daftar Akun</button>
  </form>

  <!-- Toggle Button -->
  <button id="toggle-btn">Buat Akun Baru</button>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbynI7hCthhTu6bpZRigf608aSGLxRTwCR3DxxvmR206k3JaMVPOHxzgOiTlKDSkvNyg/exec";

    // SHA-256
    async function sha256(text) {
      const encoder = new TextEncoder();
      const data = encoder.encode(text);
      const hashBuffer = await crypto.subtle.digest("SHA-256", data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    const toggleBtn = document.getElementById("toggle-btn");
    const loginForm = document.getElementById("login-form");
    const registerForm = document.getElementById("register-form");
    const formTitle = document.getElementById("form-title");

    let showRegister = false;

    toggleBtn.addEventListener("click", () => {
      showRegister = !showRegister;
      loginForm.style.display = showRegister ? "none" : "block";
      registerForm.style.display = showRegister ? "block" : "none";
      toggleBtn.textContent = showRegister ? "Kembali ke Login" : "Buat Akun Baru";
      formTitle.textContent = showRegister ? "Registrasi Akun Baru" : "Login Admin";
    });

    // Login
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;
      const passwordHash = await sha256(password);

      const res = await fetch(`${GAS_URL}?action=login&username=${encodeURIComponent(username)}&password=${passwordHash}`);
      const text = await res.text();

      if (text === "OK") {
        alert("✅ Login berhasil!");
        localStorage.setItem("login", "true");
        window.location.href = "stok.html";
      } else {
        alert("❌ Login gagal: " + text);
      }
    });

    // Registrasi
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("register-username").value;
      const password = document.getElementById("register-password").value;
      const passwordHash = await sha256(password);

      const res = await fetch(`${GAS_URL}?action=register&username=${encodeURIComponent(username)}&password=${passwordHash}`);
      const text = await res.text();

      if (text.toLowerCase().includes("berhasil")) {
        alert("✅ Akun berhasil didaftarkan!");

        // Kembali ke form login
        showRegister = false;
        loginForm.style.display = "block";
        registerForm.style.display = "none";
        toggleBtn.textContent = "Buat Akun Baru";
        formTitle.textContent = "Login Admin";

        // Isi otomatis username & password
        document.getElementById("login-username").value = username;
        document.getElementById("login-password").value = password;

        // Simulasikan klik login
        loginForm.requestSubmit();
      } else {
        alert("❌ Registrasi gagal: " + text);
      }
    });
  </script>
</body>
</html>
